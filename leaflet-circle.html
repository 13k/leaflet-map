<link rel="import" href="leaflet-import.html">
<link rel="import" href="leaflet-path.html">

<!--
The `leaflet-circle` element represents a circle on the map and is used as
a child element of the `leaflet-map` element.


##### Example: Add circles
    <leaflet-map longitude="77.2" latitude="28.4" zoom="12">
      <leaflet-circle longitude="77.2" latitude="28.4" radius="300">
        Circle
      </leaflet-circle>
    </leaflet-map>

@element leaflet-circle
@blurb Element for putting a circle on the map
@status beta
@homepage https://nhnb.github.io/leaflet-map/
@extends leaflet-path
-->
<dom-module id="leaflet-circle">
	<style>
		:host{ display: none; }
	</style>
	<template>
	</template>
</dom-module>
<script>
	"use strict";
	
	Polymer({
		is: 'leaflet-circle',

		/**
		 * A Leaflet circle object
		 *
		 * @property feature
		 * @type L.circle
		 * @default null
		 */
		feature: null,
		behaviors: [LeafletPath, LeafletPopupContent],

		properties: {
			/**
			 * The circle's longitude coordinate
			 *
			 * @attribute longitude
			 * @type number
			 * @default null
			 */
			longitude: {
				type: Number,
				observer: '_updatePosition'
			},
	
			/**
			 * The circle's latitude coordinate
			 *
			 * @attribute latitude
			 * @type number
			 * @default null
			 */
			latitude: {
				type: Number,
				observer: '_updatePosition'
			},
	
			/**
			 * The circle's radius is metres
			 *
			 * @attribute radius
			 * @type number
			 * @default 100
			 */
			radius: {
				type: Number,
				value: 100,
				observer: '_updateRadius'
			},
			
			container: {
				type: Object,
				observer: '_containerChanged'
			}
		},
		
		
		_containerChanged: function() {
			if (this.latitude && this.longitude && this.container) {
		    	this.feature = L.circle([this.latitude, this.longitude], this.radius, this.getPathOptions());
		    	this.feature.addTo(this.container);
		    	this.updatePopupContent();

			    // forward events
				this.feature.on('click dblclick mousedown mouseover mouseout contextmenu add remove popupopen popupclose', function(e) {
			    	this.fire(e.type, e);
				}, this);
			}
		},
	
		_updatePosition: function () {
			if (this.feature && this.latitude != null && this.longitude != null) {
				this.feature.setLatLng(L.latLng( this.latitude, this.longitude) );
			}
		},
		
		_updateRadius: function () {
			if (this.feature && this.radius != null) {
				this.feature.setRadius(this.radius);
			}
		},
		
		detached: function() {
			if (this.container && this.feature) {
				this.container.removeLayer(this.feature);
			}
		}
	});
</script>
